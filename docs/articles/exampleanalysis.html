<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lme4">
<title>Example Analysis • lme4</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.5/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.5/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis">
<meta property="og:description" content="lme4">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lme4</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1-35.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/exampleanalysis.html">Example Analysis</a>
    <a class="dropdown-item" href="../articles/lmerperf.html">lme4 performance tips</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lme4/lme4/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lme4/lme4/blob/HEAD/vignettes/exampleanalysis.Rmd" class="external-link"><code>vignettes/exampleanalysis.Rmd</code></a></small>
      <div class="d-none name"><code>exampleanalysis.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Example Analysis}
-->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/" class="external-link">"lme4"</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="topic-vaccination-rates">Topic: vaccination rates<a class="anchor" aria-label="anchor" href="#topic-vaccination-rates"></a>
</h3>
<p>This analysis aims to explore vaccination rates in the United States.
In particular, measles specific and overall vaccination rates are
compared to get a proxy of whether vaccination rates tend to differ
depending on the specific vaccine. Furthermore, different state and
school types are tested as predictors for vaccination rates.</p>
</div>
<div class="section level3">
<h3 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>The data comes the <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-25/readme.md#measles" class="external-link">Measles
tidytuesday</a>. It contains immunization rate data for schools across
the U.S., as compiled by The Wall Street Journal. The dataset includes
the overall and MMR-specific vaccination rates for 46,412 schools in 32
states.</p>
</div>
<div class="section level3">
<h3 id="data-dictionary">Data Dictionary<a class="anchor" aria-label="anchor" href="#data-dictionary"></a>
</h3>
<p>A data dictionary can be found <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-25/readme.md#data-dictionary" class="external-link">here</a></p>
</div>
<div class="section level3">
<h3 id="loading-data">Loading Data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Helpful functions</span></span>
<span><span class="co"># Function to check and create the 'data' directory if it doesn't exist</span></span>
<span><span class="va">check_and_create_data_directory</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data_dir</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,<span class="st">"data"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to save data</span></span>
<span><span class="va">save_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"tuesdata.rds"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Save data only if it hasn't been saved before</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">tidytuesdayR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytuesdayR/man/tt_load.html" class="external-link">tt_load</a></span><span class="op">(</span><span class="st">'2020-02-25'</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">data_path</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to read data after creating directory and saving data, as appropriate</span></span>
<span><span class="va">load_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">check_and_create_data_directory</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">save_data</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"tuesdata.rds"</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the tidytuesdayR package if not already installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"tidytuesdayR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidytuesdayR"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Load the tidytuesdayR package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thebioengineer/tidytuesdayR" class="external-link">tidytuesdayR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">load_data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">measles_data</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">measles</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-wrangling">Data Wrangling<a class="anchor" aria-label="anchor" href="#data-wrangling"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thebioengineer/tidytuesdayR" class="external-link">tidytuesdayR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'broom' was built under R version 4.2.3</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'ggplot2' was built under R version 4.2.3</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'lubridate'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     date, intersect, setdiff, union</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data wrangling: filter out NA if present</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html" class="external-link">some</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op">$</span><span class="va">type</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">||</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html" class="external-link">some</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op">$</span><span class="va">mmr</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">||</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html" class="external-link">some</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op">$</span><span class="va">overall</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">measles_data</span> <span class="op">&lt;-</span> <span class="va">measles_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mmr</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">overall</span><span class="op">)</span><span class="op">)</span>   </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a variable for total exemptions</span></span>
<span><span class="va">measles_data</span> <span class="op">&lt;-</span> <span class="va">measles_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total_exemptions <span class="op">=</span> <span class="va">xrel</span> <span class="op">+</span> <span class="va">xmed</span> <span class="op">+</span> <span class="va">xper</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a function to check if any value is 0-100</span></span>
<span><span class="va">is_perc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span><span class="op">&lt;=</span><span class="fl">100</span> <span class="op">&amp;&amp;</span> <span class="va">x</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply the condition using purrr::map</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html" class="external-link">every</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op">$</span><span class="va">overall</span>, <span class="va">is_perc</span><span class="op">)</span><span class="op">&amp;&amp;</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/every.html" class="external-link">every</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op">$</span><span class="va">overall</span>, <span class="va">is_perc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">measles_data</span> <span class="op">&lt;-</span> <span class="va">measles_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">overall</span><span class="op">&lt;</span><span class="fl">100</span>,<span class="va">overall</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="va">mmr</span><span class="op">&lt;</span><span class="fl">100</span>,<span class="va">mmr</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-and-visualizations">Analysis and Visualizations<a class="anchor" aria-label="anchor" href="#analysis-and-visualizations"></a>
</h3>
<p>First, let us look at how vaccination rates vary across different
school types.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summary statistics by school type</span></span>
<span><span class="va">summary_by_type</span> <span class="op">&lt;-</span> <span class="va">measles_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>School_type<span class="op">=</span><span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">School_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>Average_Measles_Vaccination_Percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mmr</span><span class="op">)</span>,</span>
<span>            Average_Overall_Vaccination_Percentage<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overall</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_by_type</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   School_type  Average_Measles_Vaccination_Percentage Average_Overall_Vaccinat…¹</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Kindergarten                                   89.7                       85.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Private                                        92.4                       90.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Public                                         95.8                       94.5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated name: ¹​Average_Overall_Vaccination_Percentage</span></span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization: Vaccination rates by school type</span></span>
<span><span class="va">plot_vaccination_by_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">measles_data</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>,<span class="va">overall</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">type</span>, y <span class="op">=</span> <span class="va">overall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Vaccination Rates by School Type"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Distribution of overall vaccination rates across school types"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"School Type"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Overall Vaccination Rate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_vaccination_by_type</span><span class="op">)</span></span></code></pre></div>
<p><img src="exampleanalysis_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>From the above it seems that avergae vaccination rates do vary by
school type with them being highest in public schools. In each group,
the vaccination percentage distribution is severely left-skewed with
some schools having significantly lower vaccination rates than
average.</p>
<p>Let us repeat the same boxplot state-by-state</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_vaccination_by_type_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">measles_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">type</span>, y <span class="op">=</span> <span class="va">overall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Vaccination Rates by School Type"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Distribution of overall vaccination rates across school types by state"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"School Type"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Overall Vaccination Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">state</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_vaccination_by_type_state</span><span class="op">)</span></span></code></pre></div>
<p><img src="exampleanalysis_files/figure-html/unnamed-chunk-6-1.png" width="700">
The data by state is limited but it still appears the public schools
have higher vaccination percentage than prvate schools.</p>
<p>From the first table it also appeared that measles vaccination
percentage and overall vaccination percentage are correlated. Let us
further explore</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear regression model to predict overall vaccination rate based on MMR rate</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">overall</span> <span class="op">~</span> <span class="va">mmr</span>, data <span class="op">=</span> <span class="va">measles_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidy the model results</span></span>
<span><span class="va">tidy_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tidy_results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   term        estimate std.error statistic p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)   -<span style="color: #BB0000;">15.2</span>    0.327       -<span style="color: #BB0000;">46.6</span>       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mmr             1.14   0.003<span style="text-decoration: underline;">43</span>     334.        0</span></span></code></pre>
<p>The regression results above strongly support the positive
correlation between measles vaccination percentage and overall
vaccination percentage, as is also illustrated below</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization: Scatter plot of overall vs. Measles vaccination rate</span></span>
<span><span class="va">plot_mmr_vs_overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">measles_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mmr</span>, y <span class="op">=</span> <span class="va">overall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Overall vs. Measles Vaccination Rate"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Relationship between overall  vaccination rate and Measles, Mumps, and Rubella (MMR) rate"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Measles Vaccination Rate"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Overall Vaccination Rate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_mmr_vs_overall</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="exampleanalysis_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Please, note that while the regression line is still a tool to see
the relationship between the two rates, in order to use for predictions
it would have been more appropriate to build a model where “y” values
are constrained between 0 and 100.</p>
<p>Now, let us use the lme4 package to fixed a linear mixed-effect model
that also considers state as predictor. Let us also extract the random
effect associated to each state</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a linear mixed-effects model</span></span>
<span><span class="va">mixed_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmer.html">lmer</a></span><span class="op">(</span><span class="va">overall</span> <span class="op">~</span> <span class="va">mmr</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">state</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">measles_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mixed_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">## Formula: overall ~ mmr + (1 | state)</span></span>
<span><span class="co">##    Data: measles_data</span></span>
<span><span class="co">## REML criterion at convergence: 90884.88</span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups   Name        Std.Dev.</span></span>
<span><span class="co">##  state    (Intercept) 1.361   </span></span>
<span><span class="co">##  Residual             3.216   </span></span>
<span><span class="co">## Number of obs: 17561, groups:  state, 3</span></span>
<span><span class="co">## Fixed Effects:</span></span>
<span><span class="co">## (Intercept)          mmr  </span></span>
<span><span class="co">##     -14.263        1.125</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract random effects</span></span>
<span><span class="va">random_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ranef.html">ranef</a></span><span class="op">(</span><span class="va">mixed_model</span><span class="op">)</span></span>
<span><span class="va">random_effects</span></span></code></pre></div>
<pre><code><span><span class="co">## $state</span></span>
<span><span class="co">##            (Intercept)</span></span>
<span><span class="co">## California   0.9759197</span></span>
<span><span class="co">## Colorado    -1.5514923</span></span>
<span><span class="co">## Ohio         0.5755726</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## with conditional variances for "state"</span></span></code></pre>
<p>We can interpret the random effects ($state (Intercept) above) as the
average difference between that state’s overall vaccination rate and the
average overall vaccination rate. We can rank in order of overall
vaccination percentage: California, Ogio, Colorado.</p>
</div>
<div class="section level3">
<h3 id="ta-help">TA Help<a class="anchor" aria-label="anchor" href="#ta-help"></a>
</h3>
<p>6 functions from dplyr, tidyr, lubridate, stringr, or forcats: -
dplyr::filter - dplyr::mutate - dplyr::group_by - dplyr::summarise -
dplyr::select - dplyr::rename 2 functions from purrr: - some - every 3
functions from ggplo2 + faceting: - geom_boxplot - geom_smooth -
geom_point - facet_wrap 2 functions from lme4: - lmer - ranef</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Douglas Bates, Martin Maechler, Ben Bolker, Steven Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
